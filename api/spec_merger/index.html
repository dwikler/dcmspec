
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../spec_model/">
      
      
        <link rel="next" href="../service_attribute_model/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>SpecMerger - DCMspec Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dcmspec.spec_merger.SpecMerger" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DCMspec Documentation" class="md-header__button md-logo" aria-label="DCMspec Documentation" data-md-component="logo">
      
  <img src="../../images/dcmspec_logo_100.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DCMspec Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SpecMerger
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DCMspec Documentation" class="md-nav__button md-logo" aria-label="DCMspec Documentation" data-md-component="logo">
      
  <img src="../../images/dcmspec_logo_100.png" alt="logo">

    </a>
    DCMspec Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration & Caching
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CLI Applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CLI Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Apps Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/modattributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    modattributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/iodattributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    iodattributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/iodmodules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    iodmodules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/dataelements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dataelements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/uidvalues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uidvalues
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/upsdimseattributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    upsdimseattributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/upsioddimseattributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    upsioddimseattributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cli/tdwiicontent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tdwiicontent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UI Applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            UI Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Apps Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/ui/iod-explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IOD Explorer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Constants Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Constants Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service_attribute_defaults/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Attribute Defaults
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Core Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpecModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    SpecMerger
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    SpecMerger
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SpecMerger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SpecMerger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_many" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_path" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_path_with_default" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_path_with_default
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../service_attribute_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ServiceAttributeModel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec_factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpecFactory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iod_spec_builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IODSpecBuilder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../module_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ModuleRegistry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Parse Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Parse Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec_parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpecParser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dom_table_spec_parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DOMTableSpecParser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../csv_table_spec_parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSVTableSpecParser
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Load Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Load Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../doc_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DocHandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xhtml_doc_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XHTMLDocHandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ups_xhtml_doc_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UPSXHTMLDocHandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pdf_doc_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDFDocHandler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Store Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Store Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpecStore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json_spec_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSONSpecStore
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Print Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Print Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec_printer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SpecPrinter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iod_spec_printer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IODSpecPrinter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils Classes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            Utils Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dom_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DOMUtils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../progress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Progress
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SpecMerger
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SpecMerger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_many" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_node" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_path" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcmspec.spec_merger.SpecMerger.merge_path_with_default" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;merge_path_with_default
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>SpecMerger</h1>

<div class="doc doc-object doc-class">



<h2 id="dcmspec.spec_merger.SpecMerger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>dcmspec.spec_merger.SpecMerger</code>


</h2>


    <div class="doc doc-contents first">


        <p>Merges multiple DICOM specification models.</p>
<p>The SpecMerger class provides methods to combine and enrich DICOM SpecModel objects,
supporting both path-based and node-based merging strategies. This is useful for
workflows where you need to sequentially merge two or more models, such as enriching
PS3.3 module attributes models with definitions from the PS3.6 data elements dictionary,
or combining a PS3.3 specification with a PS3.4 SOP class and then enriching with an 
IHE profile specification.</p>







              <details class="quote">
                <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SpecMerger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merges multiple DICOM specification models.</span>

<span class="sd">    The SpecMerger class provides methods to combine and enrich DICOM SpecModel objects,</span>
<span class="sd">    supporting both path-based and node-based merging strategies. This is useful for</span>
<span class="sd">    workflows where you need to sequentially merge two or more models, such as enriching</span>
<span class="sd">    PS3.3 module attributes models with definitions from the PS3.6 data elements dictionary,</span>
<span class="sd">    or combining a PS3.3 specification with a PS3.4 SOP class and then enriching with an </span>
<span class="sd">    IHE profile specification.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_store</span><span class="p">:</span> <span class="n">SpecStore</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the SpecMerger.</span>

<span class="sd">        Sets up the logger for the merger. If no logger is provided, a default logger is created.</span>
<span class="sd">        If no model_store is provided, defaults to JSONSpecStore.</span>

<span class="sd">        Args:</span>
<span class="sd">            config (Optional[Config]): Configuration object. If None, a default Config is created.</span>
<span class="sd">            model_store (Optional[SpecStore]): Store for loading and saving models. Defaults to JSONSpecStore.</span>
<span class="sd">            logger (Optional[logging.Logger]): Logger instance to use. If None, a default logger is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_store</span> <span class="o">=</span> <span class="n">model_store</span> <span class="ow">or</span> <span class="n">JSONSpecStore</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects using the node merge method, with optional caching.</span>

<span class="sd">        This is a convenience method that calls merge_many with two models.</span>

<span class="sd">        Args:</span>
<span class="sd">            model1 (SpecModel): The first model.</span>
<span class="sd">            model2 (SpecModel): The second model to merge with the first.</span>
<span class="sd">            match_by (str, optional): &quot;name&quot; to match by node name, &quot;attribute&quot; to match by a specific attribute.</span>
<span class="sd">            attribute_name (str, optional): The attribute name to use for matching.</span>
<span class="sd">            merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">            json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">            force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SpecModel: The merged SpecModel instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_many</span><span class="p">(</span>
            <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">],</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;matching_node&quot;</span><span class="p">,</span>
            <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
            <span class="n">attribute_names</span><span class="o">=</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">],</span>
            <span class="n">merge_attrs_list</span><span class="o">=</span><span class="p">[</span><span class="n">merge_attrs</span><span class="p">],</span>
            <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
            <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
        <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">,</span>
        <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects using the path merge method, with optional caching.</span>

<span class="sd">        This is a convenience method that calls merge_many with two models.</span>

<span class="sd">        By default, this method matches nodes by their DICOM tag (attribute_name=&quot;elem_tag&quot;) using</span>
<span class="sd">        path-based merging (match_by=&quot;attribute&quot;). This is the recommended and robust approach for</span>
<span class="sd">        DICOM attribute-level merging, as DICOM tags are unique and consistent identifiers.</span>

<span class="sd">        Args:</span>
<span class="sd">            model1 (SpecModel): The first model.</span>
<span class="sd">            model2 (SpecModel): The second model to merge with the first.</span>
<span class="sd">            match_by (str, optional): &quot;attribute&quot; (default, recommended) to match by a specific attribute (DICOM tag),</span>
<span class="sd">                or &quot;name&quot; to match by node name.</span>
<span class="sd">            attribute_name (str, optional): The attribute name to use for matching (default: &quot;elem_tag&quot;).</span>
<span class="sd">            merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">            json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">            force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">            ignore_module_level (bool, optional): If True, skip the module level when matching paths.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SpecModel: The merged SpecModel instance.</span>

<span class="sd">        Note:</span>
<span class="sd">            For DICOM attribute-level merging, the default (match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot;)</span>
<span class="sd">            is strongly recommended. Only use match_by=&quot;name&quot; for special cases where tag-based matching is</span>
<span class="sd">            not possible.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_many</span><span class="p">(</span>
            <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">],</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;matching_path&quot;</span><span class="p">,</span>
            <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
            <span class="n">attribute_names</span><span class="o">=</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">],</span>
            <span class="n">merge_attrs_list</span><span class="o">=</span><span class="p">[</span><span class="n">merge_attrs</span><span class="p">],</span>
            <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
            <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
            <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_path_with_default</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
        <span class="n">default_value_func</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects by path, and set a default value for missing attributes.</span>

<span class="sd">        This method merges two models using the path-based merge strategy (matching nodes by their</span>
<span class="sd">        hierarchical path and by DICOM tag, i.e., match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot; by default),</span>
<span class="sd">        and then sets `default_attr` to `default_value` for any node in the merged model that does not already</span>
<span class="sd">        have that attribute.</span>

<span class="sd">        This is especially useful for workflows where you want to enrich a normalized IOD model</span>
<span class="sd">        (e.g., from DICOM PS3.3) with a service attribute model (e.g., from DICOM PS3.4 or an IHE</span>
<span class="sd">        profile), and you want to ensure that all nodes in the merged model have a value for the</span>
<span class="sd">        Type attribute.</span>

<span class="sd">        Use case:</span>
<span class="sd">            - Merging a DICOM PS3.3 normalized IOD attributes specification (e.g., built with IODSpecBuilder)</span>
<span class="sd">              with a DICOM PS3.4 DIMSE SCU or SCP attributes specification (e.g., built with ServiceAttributeModel</span>
<span class="sd">              and select_dimse/select_role). After merging, any node present in the normalized IOD model but</span>
<span class="sd">              missing from the service attribute model will have its &quot;Type&quot; (or other specified attribute)</span>
<span class="sd">              set to the default value (e.g., &quot;3&quot;), ensuring the merged model is complete and ready for</span>
<span class="sd">              further processing or export.</span>

<span class="sd">        Args:</span>
<span class="sd">            model1 (SpecModel): The first model (e.g., normalized IOD).</span>
<span class="sd">            model2 (SpecModel): The second model (e.g., service attribute model).</span>
<span class="sd">            match_by (str, optional): &quot;attribute&quot; (default, recommended) to match by a specific attribute (DICOM tag),</span>
<span class="sd">                or &quot;name&quot; to match by node name.</span>
<span class="sd">            attribute_name (str, optional): The attribute name to use for matching (default: &quot;elem_tag&quot;).</span>
<span class="sd">            merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">            default_attr (str, optional): The attribute to set if missing (default: &quot;elem_type&quot;).</span>
<span class="sd">            default_value (str, optional): The value to set for missing attributes (default: &quot;3&quot;).</span>
<span class="sd">            default_value_func (callable, optional): A function to determine the default value for missing attributes.</span>
<span class="sd">                If provided, it will be called as</span>
<span class="sd">                `default_value_func(node, merged_model, service_model, default_attr, default_value)`</span>
<span class="sd">                and should return the value to use for the missing attribute.</span>
<span class="sd">            json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">            force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">            ignore_module_level (bool, optional): If True, skip the module level when matching paths.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SpecModel: The merged SpecModel instance with default values set for missing attributes.</span>

<span class="sd">        Note:</span>
<span class="sd">            For DICOM attribute-level merging, the default (match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot;)</span>
<span class="sd">            is strongly recommended. Only use match_by=&quot;name&quot; for special cases where tag-based matching is</span>
<span class="sd">            not possible.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_path</span><span class="p">(</span>
            <span class="n">model1</span><span class="p">,</span>
            <span class="n">model2</span><span class="p">,</span>
            <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
            <span class="n">attribute_name</span><span class="o">=</span><span class="n">attribute_name</span><span class="p">,</span>
            <span class="n">merge_attrs</span><span class="o">=</span><span class="n">merge_attrs</span><span class="p">,</span>
            <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
            <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
            <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
            <span class="c1"># Only set default_attr on nodes that have the match attribute (attribute_name) and are not module nodes</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">attribute_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">default_value_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">default_value_func</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">merged</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">default_value</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_many</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpecModel</span><span class="p">],</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">attribute_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge a sequence of DICOM SpecModel objects using the specified merge method, with optional caching.</span>

<span class="sd">        This method merges a list of models in order, applying either path-based or node-based</span>
<span class="sd">        merging at each step. You can specify different attribute names and lists of attributes</span>
<span class="sd">        to merge for each step, allowing for flexible, multi-stage enrichment of DICOM models.</span>
<span class="sd">        If json_file_name is provided, the merged model will be cached to that file, and loaded from</span>
<span class="sd">        cache if available and force_update is False.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (list of SpecModel): The models to merge, in order.</span>
<span class="sd">            method (str): Merge method to use (&quot;matching_path&quot; or &quot;matching_node&quot;).</span>
<span class="sd">            match_by (str): &quot;name&quot; to match by node name, &quot;attribute&quot; to match by a specific attribute.</span>
<span class="sd">            attribute_names (list, optional): List of attribute names to use for each merge step.</span>
<span class="sd">                Each entry corresponds to a merge operation between two models.</span>
<span class="sd">                Required if match_by=&quot;attribute&quot;. If match_by=&quot;name&quot;, can be None.</span>
<span class="sd">            merge_attrs_list (list, optional): List of lists of attribute names to merge for each merge step.</span>
<span class="sd">                Each entry corresponds to a merge operation between two models.</span>
<span class="sd">            json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">            force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">            ignore_module_level (bool, optional): If True, skip the module level when matching paths (only applies</span>
<span class="sd">                to path-based merging).</span>

<span class="sd">        Returns:</span>
<span class="sd">            SpecModel: The final merged SpecModel instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If models is empty, method is unknown, or attribute_names/merge_attrs_list</span>
<span class="sd">                have incorrect length, or if attribute_names is not set when match_by=&quot;attribute&quot;.</span>

<span class="sd">        Note:</span>
<span class="sd">            - For path-based merging of DICOM attributes, it is recommended to use match_by=&quot;attribute&quot;</span>
<span class="sd">              and attribute_names=[&quot;elem_tag&quot;, ...] for robust, tag-based matching.</span>
<span class="sd">            - For node-based merging or special cases, match_by=&quot;name&quot; can be used and attribute_names may be None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that required arguments are set</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">match_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;merge_many requires method and match_by to be set explicitly by the caller.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">match_by</span> <span class="o">==</span> <span class="s2">&quot;attribute&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">attribute_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attribute_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;merge_many requires attribute_names to be set when match_by=&#39;attribute&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="n">orig_col2attr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">models</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">):</span>
            <span class="n">orig_col2attr</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">column_to_attr</span>
        <span class="n">cached_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_merged_model_from_cache</span><span class="p">(</span><span class="n">json_file_name</span><span class="p">,</span> <span class="n">force_update</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">,</span> <span class="n">orig_col2attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached_model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_merge_args</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">attribute_names</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">)</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_models</span><span class="p">(</span>
            <span class="n">models</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
            <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
            <span class="n">merge_attrs_list</span><span class="o">=</span><span class="n">merge_attrs_list</span><span class="p">,</span>
            <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metadata</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_cache</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">json_file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_merge_args</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpecModel</span><span class="p">],</span>
        <span class="n">attribute_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and normalize merge arguments for merging models.</span>

<span class="sd">        This function ensures that the lists of attribute names and merge attribute lists</span>
<span class="sd">        are the correct length and format for the number of merges to be performed.</span>
<span class="sd">        It also normalizes single values to lists, so that downstream code can always</span>
<span class="sd">        assume lists of the correct length.</span>

<span class="sd">        - If attribute_names or merge_attrs_list are None or a single value, they are expanded to lists.</span>
<span class="sd">        - If their length does not match the number of merges (len(models) - 1), a ValueError is raised.</span>

<span class="sd">        This normalization allows the merge logic to always use attribute_names[i] and merge_attrs_list[i]</span>
<span class="sd">        for each merge step, regardless of how the arguments were originally provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No models to merge&quot;</span><span class="p">)</span>
        <span class="n">n_merges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Normalize attribute_names: ensure it&#39;s a list of length n_merges</span>
        <span class="k">if</span> <span class="n">attribute_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attribute_names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_merges</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># If a single value is provided, expand it to a list</span>
            <span class="n">attribute_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">attribute_names</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_merges</span>

        <span class="c1"># Normalize merge_attrs_list: ensure it&#39;s a list of lists of length n_merges</span>
        <span class="k">if</span> <span class="n">merge_attrs_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">merge_attrs_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_merges</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merge_attrs_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="n">merge_attrs_list</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merge_attrs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># If a single value or a flat list is provided, expand it to a list of lists</span>
            <span class="n">merge_attrs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">merge_attrs_list</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_merges</span>

        <span class="c1"># Validate lengths</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attribute_names</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_merges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Length of attribute_names (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">attribute_names</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;does not match number of merges (</span><span class="si">{</span><span class="n">n_merges</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">merge_attrs_list</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_merges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Length of merge_attrs_list (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">merge_attrs_list</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;does not match number of merges (</span><span class="si">{</span><span class="n">n_merges</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_merge_models</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpecModel</span><span class="p">],</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;matching_path&quot;</span><span class="p">,</span>
        <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="n">attribute_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the actual merging of models using the specified method.&quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;matching_path&quot;</span><span class="p">,</span> <span class="s2">&quot;matching_node&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown merge method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">attribute_name</span> <span class="o">=</span> <span class="n">attribute_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">merge_attrs</span> <span class="o">=</span> <span class="n">merge_attrs_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;matching_node&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Merging model </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> by node with match_by=</span><span class="si">{</span><span class="n">match_by</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute_name=</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">, merge_attrs=</span><span class="si">{</span><span class="n">merge_attrs</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">merge_matching_node</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span> <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span> <span class="n">attribute_name</span><span class="o">=</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">merge_attrs</span><span class="o">=</span><span class="n">merge_attrs</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;matching_path&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Merging model </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> by path with match_by=</span><span class="si">{</span><span class="n">match_by</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute_name=</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">, merge_attrs=</span><span class="si">{</span><span class="n">merge_attrs</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;ignore_module_level=</span><span class="si">{</span><span class="n">ignore_module_level</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">merge_matching_path</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
                    <span class="n">attribute_name</span><span class="o">=</span><span class="n">attribute_name</span><span class="p">,</span>
                    <span class="n">merge_attrs</span><span class="o">=</span><span class="n">merge_attrs</span><span class="p">,</span>
                    <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_missing_nodes_from_model</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">merged</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpecModel</span><span class="p">],</span>
        <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the metadata of the merged model to reflect merged attributes.&quot;&quot;&quot;</span>
        <span class="c1"># Start with the original metadata</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">orig_header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">orig_col2attr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="c1"># Find the next available column index</span>
        <span class="n">next_col</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">orig_col2attr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">orig_col2attr</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c1"># For each merged-in model, add new merged attributes if not already present</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">merge_attrs</span> <span class="o">=</span> <span class="n">merge_attrs_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">other_meta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">other_meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">merge_attrs</span><span class="p">:</span>
                <span class="n">other_header</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other_meta</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">other_col2attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other_meta</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">other_header</span> <span class="ow">and</span> <span class="n">other_col2attr</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">other_col2attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">merge_attrs</span> <span class="ow">and</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orig_col2attr</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="c1"># Add new column for this attribute</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_header</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_header</span><span class="p">):</span>
                                <span class="n">orig_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_header</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">orig_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                            <span class="n">orig_col2attr</span><span class="p">[</span><span class="n">next_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
                            <span class="n">next_col</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">):</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">orig_header</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">):</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">column_to_attr</span> <span class="o">=</span> <span class="n">orig_col2attr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_cache</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">merged</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the merged model to cache if a json_file_name is provided.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">json_file_name</span><span class="p">:</span>
            <span class="n">merged_json_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;cache_dir&quot;</span><span class="p">),</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">json_file_name</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_store</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">merged_json_file_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cache merged model to </span><span class="si">{</span><span class="n">merged_json_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No json_file_name specified; merged model not cached.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_merged_model_from_cache</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">orig_col2attr</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cached merged model if available, valid, and not force_update, else None.&quot;&quot;&quot;</span>
        <span class="n">merged_json_file_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">json_file_name</span><span class="p">:</span>
            <span class="n">merged_json_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;cache_dir&quot;</span><span class="p">),</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">json_file_name</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">merged_json_file_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">merged_json_file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_update</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_store</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">merged_json_file_path</span><span class="p">)</span>
                <span class="c1"># Check that all requested merge attributes are present in the cached model&#39;s metadata</span>
                <span class="k">if</span> <span class="n">merge_attrs_list</span><span class="p">:</span>
                    <span class="n">all_attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">merge_attrs_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
                            <span class="n">all_attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                    <span class="n">col2attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">orig_attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">orig_col2attr</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">orig_col2attr</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="c1"># All requested attributes must be present</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col2attr</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">all_attrs</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cached model at </span><span class="si">{</span><span class="n">merged_json_file_path</span><span class="si">}</span><span class="s2"> missing required merged attributes </span><span class="si">{</span><span class="n">all_attrs</span><span class="si">}</span><span class="s2">; &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;ignoring cache.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
                    <span class="c1"># No extra attributes except those in the original model</span>
                    <span class="n">allowed_attrs</span> <span class="o">=</span> <span class="n">all_attrs</span> <span class="o">|</span> <span class="n">orig_attrs</span>
                    <span class="n">extra_attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col2attr</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="n">allowed_attrs</span>
                    <span class="k">if</span> <span class="n">extra_attrs</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cached model at </span><span class="si">{</span><span class="n">merged_json_file_path</span><span class="si">}</span><span class="s2"> contains extra attributes </span><span class="si">{</span><span class="n">extra_attrs</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;not requested; ignoring cache.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Loaded model from cache </span><span class="si">{</span><span class="n">merged_json_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">model</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to load merged model from cache </span><span class="si">{</span><span class="n">merged_json_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_missing_nodes_from_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">merged</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add nodes from model that are not present in merged (by path).&quot;&quot;&quot;</span>

        <span class="c1"># Use elem_tag path normalized to uppercase for missing node detection</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">tag_path</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">path</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">merged_tag_paths</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag_path</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)}</span>
        <span class="n">added_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
            <span class="n">node2_tag_path</span> <span class="o">=</span> <span class="n">tag_path</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">node2_tag_path</span>
                <span class="ow">and</span> <span class="n">node2_tag_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">merged_tag_paths</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="s2">&quot;elem_name&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># Find parent by tag path</span>
                <span class="n">parent_tag_path</span> <span class="o">=</span> <span class="n">node2_tag_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tag_path</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="n">parent_tag_path</span><span class="p">:</span>
                        <span class="n">parent</span> <span class="o">=</span> <span class="n">n</span>
                        <span class="k">break</span>
                <span class="n">elem_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="s2">&quot;elem_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                        <span class="n">elem_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;All other Attributes&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">elem_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;All Attributes&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">new_node</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
                    <span class="n">new_node</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
                    <span class="n">merged_tag_paths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node2_tag_path</span><span class="p">)</span>
                    <span class="n">added_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Added missing node from model: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">None</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;at tag_path </span><span class="si">{</span><span class="n">node2_tag_path</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total missing nodes added from model: </span><span class="si">{</span><span class="n">added_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="dcmspec.spec_merger.SpecMerger.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the SpecMerger.</p>
<p>Sets up the logger for the merger. If no logger is provided, a default logger is created.
If no model_store is provided, defaults to JSONSpecStore.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Configuration object. If None, a default Config is created.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            dcmspec.config.Config" href="../config/#dcmspec.config.Config">Config</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_store</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Store for loading and saving models. Defaults to JSONSpecStore.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="Optional">Optional</span>[<a class="autorefs autorefs-internal" title="            dcmspec.spec_store.SpecStore (dcmspec.spec_factory.SpecStore)" href="../spec_store/#dcmspec.spec_store.SpecStore">SpecStore</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Logger instance to use. If None, a default logger is created.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="Optional">Optional</span>[<span title="logging.Logger">Logger</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_store</span><span class="p">:</span> <span class="n">SpecStore</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the SpecMerger.</span>

<span class="sd">    Sets up the logger for the merger. If no logger is provided, a default logger is created.</span>
<span class="sd">    If no model_store is provided, defaults to JSONSpecStore.</span>

<span class="sd">    Args:</span>
<span class="sd">        config (Optional[Config]): Configuration object. If None, a default Config is created.</span>
<span class="sd">        model_store (Optional[SpecStore]): Store for loading and saving models. Defaults to JSONSpecStore.</span>
<span class="sd">        logger (Optional[logging.Logger]): Logger instance to use. If None, a default logger is created.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">Config</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_store</span> <span class="o">=</span> <span class="n">model_store</span> <span class="ow">or</span> <span class="n">JSONSpecStore</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dcmspec.spec_merger.SpecMerger.merge_many" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">merge_many</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">match_by</span><span class="p">,</span> <span class="n">attribute_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_module_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge a sequence of DICOM SpecModel objects using the specified merge method, with optional caching.</p>
<p>This method merges a list of models in order, applying either path-based or node-based
merging at each step. You can specify different attribute names and lists of attributes
to merge for each step, allowing for flexible, multi-stage enrichment of DICOM models.
If json_file_name is provided, the merged model will be cached to that file, and loaded from
cache if available and force_update is False.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>models</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The models to merge, in order.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of SpecModel</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Merge method to use ("matching_path" or "matching_node").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_by</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"name" to match by node name, "attribute" to match by a specific attribute.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attribute_names</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of attribute names to use for each merge step.
Each entry corresponds to a merge operation between two models.
Required if match_by="attribute". If match_by="name", can be None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>merge_attrs_list</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of lists of attribute names to merge for each merge step.
Each entry corresponds to a merge operation between two models.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>json_file_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If provided, cache/load the merged model to/from this file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_update</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, always perform the merge and overwrite the cache.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_module_level</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, skip the module level when matching paths (only applies
to path-based merging).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>SpecModel</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The final merged SpecModel instance.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="ValueError">ValueError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If models is empty, method is unknown, or attribute_names/merge_attrs_list
have incorrect length, or if attribute_names is not set when match_by="attribute".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>For path-based merging of DICOM attributes, it is recommended to use match_by="attribute"
  and attribute_names=["elem_tag", ...] for robust, tag-based matching.</li>
<li>For node-based merging or special cases, match_by="name" can be used and attribute_names may be None.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_many</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpecModel</span><span class="p">],</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attribute_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">merge_attrs_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge a sequence of DICOM SpecModel objects using the specified merge method, with optional caching.</span>

<span class="sd">    This method merges a list of models in order, applying either path-based or node-based</span>
<span class="sd">    merging at each step. You can specify different attribute names and lists of attributes</span>
<span class="sd">    to merge for each step, allowing for flexible, multi-stage enrichment of DICOM models.</span>
<span class="sd">    If json_file_name is provided, the merged model will be cached to that file, and loaded from</span>
<span class="sd">    cache if available and force_update is False.</span>

<span class="sd">    Args:</span>
<span class="sd">        models (list of SpecModel): The models to merge, in order.</span>
<span class="sd">        method (str): Merge method to use (&quot;matching_path&quot; or &quot;matching_node&quot;).</span>
<span class="sd">        match_by (str): &quot;name&quot; to match by node name, &quot;attribute&quot; to match by a specific attribute.</span>
<span class="sd">        attribute_names (list, optional): List of attribute names to use for each merge step.</span>
<span class="sd">            Each entry corresponds to a merge operation between two models.</span>
<span class="sd">            Required if match_by=&quot;attribute&quot;. If match_by=&quot;name&quot;, can be None.</span>
<span class="sd">        merge_attrs_list (list, optional): List of lists of attribute names to merge for each merge step.</span>
<span class="sd">            Each entry corresponds to a merge operation between two models.</span>
<span class="sd">        json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">        force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">        ignore_module_level (bool, optional): If True, skip the module level when matching paths (only applies</span>
<span class="sd">            to path-based merging).</span>

<span class="sd">    Returns:</span>
<span class="sd">        SpecModel: The final merged SpecModel instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If models is empty, method is unknown, or attribute_names/merge_attrs_list</span>
<span class="sd">            have incorrect length, or if attribute_names is not set when match_by=&quot;attribute&quot;.</span>

<span class="sd">    Note:</span>
<span class="sd">        - For path-based merging of DICOM attributes, it is recommended to use match_by=&quot;attribute&quot;</span>
<span class="sd">          and attribute_names=[&quot;elem_tag&quot;, ...] for robust, tag-based matching.</span>
<span class="sd">        - For node-based merging or special cases, match_by=&quot;name&quot; can be used and attribute_names may be None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that required arguments are set</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">match_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;merge_many requires method and match_by to be set explicitly by the caller.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">match_by</span> <span class="o">==</span> <span class="s2">&quot;attribute&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">attribute_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attribute_names</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;merge_many requires attribute_names to be set when match_by=&#39;attribute&#39;.&quot;</span>
        <span class="p">)</span>
    <span class="n">orig_col2attr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">models</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;column_to_attr&quot;</span><span class="p">):</span>
        <span class="n">orig_col2attr</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">column_to_attr</span>
    <span class="n">cached_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_merged_model_from_cache</span><span class="p">(</span><span class="n">json_file_name</span><span class="p">,</span> <span class="n">force_update</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">,</span> <span class="n">orig_col2attr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cached_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cached_model</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_merge_args</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">attribute_names</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">)</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_models</span><span class="p">(</span>
        <span class="n">models</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
        <span class="n">attribute_names</span><span class="o">=</span><span class="n">attribute_names</span><span class="p">,</span>
        <span class="n">merge_attrs_list</span><span class="o">=</span><span class="n">merge_attrs_list</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_metadata</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">merge_attrs_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_cache</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">json_file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dcmspec.spec_merger.SpecMerger.merge_node" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">merge_node</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">match_by</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">attribute_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge two DICOM SpecModel objects using the node merge method, with optional caching.</p>
<p>This is a convenience method that calls merge_many with two models.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The first model.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The second model to merge with the first.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_by</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"name" to match by node name, "attribute" to match by a specific attribute.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;name&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attribute_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The attribute name to use for matching.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>merge_attrs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of attribute names to merge from the other model's node.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span>[<span title="str">str</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>json_file_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If provided, cache/load the merged model to/from this file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_update</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, always perform the merge and overwrite the cache.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>SpecModel</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The merged SpecModel instance.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_node</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects using the node merge method, with optional caching.</span>

<span class="sd">    This is a convenience method that calls merge_many with two models.</span>

<span class="sd">    Args:</span>
<span class="sd">        model1 (SpecModel): The first model.</span>
<span class="sd">        model2 (SpecModel): The second model to merge with the first.</span>
<span class="sd">        match_by (str, optional): &quot;name&quot; to match by node name, &quot;attribute&quot; to match by a specific attribute.</span>
<span class="sd">        attribute_name (str, optional): The attribute name to use for matching.</span>
<span class="sd">        merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">        json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">        force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SpecModel: The merged SpecModel instance.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_many</span><span class="p">(</span>
        <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">],</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;matching_node&quot;</span><span class="p">,</span>
        <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
        <span class="n">attribute_names</span><span class="o">=</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">],</span>
        <span class="n">merge_attrs_list</span><span class="o">=</span><span class="p">[</span><span class="n">merge_attrs</span><span class="p">],</span>
        <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
        <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dcmspec.spec_merger.SpecMerger.merge_path" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">merge_path</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">match_by</span><span class="o">=</span><span class="s1">&#39;attribute&#39;</span><span class="p">,</span> <span class="n">attribute_name</span><span class="o">=</span><span class="s1">&#39;elem_tag&#39;</span><span class="p">,</span> <span class="n">merge_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_module_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge two DICOM SpecModel objects using the path merge method, with optional caching.</p>
<p>This is a convenience method that calls merge_many with two models.</p>
<p>By default, this method matches nodes by their DICOM tag (attribute_name="elem_tag") using
path-based merging (match_by="attribute"). This is the recommended and robust approach for
DICOM attribute-level merging, as DICOM tags are unique and consistent identifiers.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The first model.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The second model to merge with the first.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_by</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"attribute" (default, recommended) to match by a specific attribute (DICOM tag),
or "name" to match by node name.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;attribute&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attribute_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The attribute name to use for matching (default: "elem_tag").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;elem_tag&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>merge_attrs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of attribute names to merge from the other model's node.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span>[<span title="str">str</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>json_file_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If provided, cache/load the merged model to/from this file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_update</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, always perform the merge and overwrite the cache.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_module_level</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, skip the module level when matching paths.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>SpecModel</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The merged SpecModel instance.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>For DICOM attribute-level merging, the default (match_by="attribute", attribute_name="elem_tag")
is strongly recommended. Only use match_by="name" for special cases where tag-based matching is
not possible.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_path</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
    <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;elem_tag&quot;</span><span class="p">,</span>
    <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects using the path merge method, with optional caching.</span>

<span class="sd">    This is a convenience method that calls merge_many with two models.</span>

<span class="sd">    By default, this method matches nodes by their DICOM tag (attribute_name=&quot;elem_tag&quot;) using</span>
<span class="sd">    path-based merging (match_by=&quot;attribute&quot;). This is the recommended and robust approach for</span>
<span class="sd">    DICOM attribute-level merging, as DICOM tags are unique and consistent identifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        model1 (SpecModel): The first model.</span>
<span class="sd">        model2 (SpecModel): The second model to merge with the first.</span>
<span class="sd">        match_by (str, optional): &quot;attribute&quot; (default, recommended) to match by a specific attribute (DICOM tag),</span>
<span class="sd">            or &quot;name&quot; to match by node name.</span>
<span class="sd">        attribute_name (str, optional): The attribute name to use for matching (default: &quot;elem_tag&quot;).</span>
<span class="sd">        merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">        json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">        force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">        ignore_module_level (bool, optional): If True, skip the module level when matching paths.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SpecModel: The merged SpecModel instance.</span>

<span class="sd">    Note:</span>
<span class="sd">        For DICOM attribute-level merging, the default (match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot;)</span>
<span class="sd">        is strongly recommended. Only use match_by=&quot;name&quot; for special cases where tag-based matching is</span>
<span class="sd">        not possible.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_many</span><span class="p">(</span>
        <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">],</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;matching_path&quot;</span><span class="p">,</span>
        <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
        <span class="n">attribute_names</span><span class="o">=</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">],</span>
        <span class="n">merge_attrs_list</span><span class="o">=</span><span class="p">[</span><span class="n">merge_attrs</span><span class="p">],</span>
        <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
        <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dcmspec.spec_merger.SpecMerger.merge_path_with_default" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">merge_path_with_default</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">match_by</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">attribute_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_attr</span><span class="o">=</span><span class="s1">&#39;elem_type&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">default_value_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_module_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge two DICOM SpecModel objects by path, and set a default value for missing attributes.</p>
<p>This method merges two models using the path-based merge strategy (matching nodes by their
hierarchical path and by DICOM tag, i.e., match_by="attribute", attribute_name="elem_tag" by default),
and then sets <code>default_attr</code> to <code>default_value</code> for any node in the merged model that does not already
have that attribute.</p>
<p>This is especially useful for workflows where you want to enrich a normalized IOD model
(e.g., from DICOM PS3.3) with a service attribute model (e.g., from DICOM PS3.4 or an IHE
profile), and you want to ensure that all nodes in the merged model have a value for the
Type attribute.</p>


<details class="use-case" open>
  <summary>Use case</summary>
  <ul>
<li>Merging a DICOM PS3.3 normalized IOD attributes specification (e.g., built with IODSpecBuilder)
  with a DICOM PS3.4 DIMSE SCU or SCP attributes specification (e.g., built with ServiceAttributeModel
  and select_dimse/select_role). After merging, any node present in the normalized IOD model but
  missing from the service attribute model will have its "Type" (or other specified attribute)
  set to the default value (e.g., "3"), ensuring the merged model is complete and ready for
  further processing or export.</li>
</ul>
</details>

<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The first model (e.g., normalized IOD).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The second model (e.g., service attribute model).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_by</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"attribute" (default, recommended) to match by a specific attribute (DICOM tag),
or "name" to match by node name.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;name&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attribute_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The attribute name to use for matching (default: "elem_tag").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>merge_attrs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of attribute names to merge from the other model's node.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="list">list</span>[<span title="str">str</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_attr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The attribute to set if missing (default: "elem_type").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;elem_type&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The value to set for missing attributes (default: "3").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;3&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_value_func</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A function to determine the default value for missing attributes.
If provided, it will be called as
<code>default_value_func(node, merged_model, service_model, default_attr, default_value)</code>
and should return the value to use for the missing attribute.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="callable">callable</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>json_file_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If provided, cache/load the merged model to/from this file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="str">str</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_update</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, always perform the merge and overwrite the cache.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_module_level</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, skip the module level when matching paths.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="bool">bool</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>SpecModel</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The merged SpecModel instance with default values set for missing attributes.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            dcmspec.spec_model.SpecModel" href="../spec_model/#dcmspec.spec_model.SpecModel">SpecModel</a></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>For DICOM attribute-level merging, the default (match_by="attribute", attribute_name="elem_tag")
is strongly recommended. Only use match_by="name" for special cases where tag-based matching is
not possible.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/dcmspec/spec_merger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_path_with_default</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model1</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">model2</span><span class="p">:</span> <span class="n">SpecModel</span><span class="p">,</span>
    <span class="n">match_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">merge_attrs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">,</span>
    <span class="n">default_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
    <span class="n">default_value_func</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">json_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_module_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SpecModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge two DICOM SpecModel objects by path, and set a default value for missing attributes.</span>

<span class="sd">    This method merges two models using the path-based merge strategy (matching nodes by their</span>
<span class="sd">    hierarchical path and by DICOM tag, i.e., match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot; by default),</span>
<span class="sd">    and then sets `default_attr` to `default_value` for any node in the merged model that does not already</span>
<span class="sd">    have that attribute.</span>

<span class="sd">    This is especially useful for workflows where you want to enrich a normalized IOD model</span>
<span class="sd">    (e.g., from DICOM PS3.3) with a service attribute model (e.g., from DICOM PS3.4 or an IHE</span>
<span class="sd">    profile), and you want to ensure that all nodes in the merged model have a value for the</span>
<span class="sd">    Type attribute.</span>

<span class="sd">    Use case:</span>
<span class="sd">        - Merging a DICOM PS3.3 normalized IOD attributes specification (e.g., built with IODSpecBuilder)</span>
<span class="sd">          with a DICOM PS3.4 DIMSE SCU or SCP attributes specification (e.g., built with ServiceAttributeModel</span>
<span class="sd">          and select_dimse/select_role). After merging, any node present in the normalized IOD model but</span>
<span class="sd">          missing from the service attribute model will have its &quot;Type&quot; (or other specified attribute)</span>
<span class="sd">          set to the default value (e.g., &quot;3&quot;), ensuring the merged model is complete and ready for</span>
<span class="sd">          further processing or export.</span>

<span class="sd">    Args:</span>
<span class="sd">        model1 (SpecModel): The first model (e.g., normalized IOD).</span>
<span class="sd">        model2 (SpecModel): The second model (e.g., service attribute model).</span>
<span class="sd">        match_by (str, optional): &quot;attribute&quot; (default, recommended) to match by a specific attribute (DICOM tag),</span>
<span class="sd">            or &quot;name&quot; to match by node name.</span>
<span class="sd">        attribute_name (str, optional): The attribute name to use for matching (default: &quot;elem_tag&quot;).</span>
<span class="sd">        merge_attrs (list[str], optional): List of attribute names to merge from the other model&#39;s node.</span>
<span class="sd">        default_attr (str, optional): The attribute to set if missing (default: &quot;elem_type&quot;).</span>
<span class="sd">        default_value (str, optional): The value to set for missing attributes (default: &quot;3&quot;).</span>
<span class="sd">        default_value_func (callable, optional): A function to determine the default value for missing attributes.</span>
<span class="sd">            If provided, it will be called as</span>
<span class="sd">            `default_value_func(node, merged_model, service_model, default_attr, default_value)`</span>
<span class="sd">            and should return the value to use for the missing attribute.</span>
<span class="sd">        json_file_name (str, optional): If provided, cache/load the merged model to/from this file.</span>
<span class="sd">        force_update (bool, optional): If True, always perform the merge and overwrite the cache.</span>
<span class="sd">        ignore_module_level (bool, optional): If True, skip the module level when matching paths.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SpecModel: The merged SpecModel instance with default values set for missing attributes.</span>

<span class="sd">    Note:</span>
<span class="sd">        For DICOM attribute-level merging, the default (match_by=&quot;attribute&quot;, attribute_name=&quot;elem_tag&quot;)</span>
<span class="sd">        is strongly recommended. Only use match_by=&quot;name&quot; for special cases where tag-based matching is</span>
<span class="sd">        not possible.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_path</span><span class="p">(</span>
        <span class="n">model1</span><span class="p">,</span>
        <span class="n">model2</span><span class="p">,</span>
        <span class="n">match_by</span><span class="o">=</span><span class="n">match_by</span><span class="p">,</span>
        <span class="n">attribute_name</span><span class="o">=</span><span class="n">attribute_name</span><span class="p">,</span>
        <span class="n">merge_attrs</span><span class="o">=</span><span class="n">merge_attrs</span><span class="p">,</span>
        <span class="n">ignore_module_level</span><span class="o">=</span><span class="n">ignore_module_level</span><span class="p">,</span>
        <span class="n">json_file_name</span><span class="o">=</span><span class="n">json_file_name</span><span class="p">,</span>
        <span class="n">force_update</span><span class="o">=</span><span class="n">force_update</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
        <span class="c1"># Only set default_attr on nodes that have the match attribute (attribute_name) and are not module nodes</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">attribute_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">default_value_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">default_value_func</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">merged</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">default_value</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">default_attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>